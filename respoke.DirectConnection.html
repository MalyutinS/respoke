<!-- Copyright 2014, Digium, Inc.--><!-- All rights reserved.--><!----><!-- This source code is licensed under The MIT License found in the--><!-- LICENSE file in the root directory of this source tree.--><!----><!-- For all details and documentation:  https://www.respoke.io--><!DOCTYPE html><html><head><title>respoke/directConnection.js - respoke.DirectConnection</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><link rel="stylesheet" href="https://highlightjs.org/static/styles/github.css"><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script><script src="https://highlightjs.org/static/highlight.pack.js"></script><style type="text/css">#navi { z-index: 1000; max-height: 99%; overflow-y: auto; overflow-x: hidden; }
#navi .nav>li>a { padding: 3px 15px; display: inline-block; }
#navi.show { max-height: 400px; }
#navi.show #menu { background: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 8px; display: block!important; }
.wrap { word-break: break-all; }</style></head><body style="position:relative" data-spy="scroll" data-target="#navi"><div id="navi" class="affix col-sm-3"><button onclick="$('#navi').toggleClass('show')" class="btn btn-default visible-xs">Menu</button><div id="menu" class="hidden-xs"><br class="hidden-xs"><ul role="tablist" class="nav nav-pills nav-stacked"><li>Properties &amp; Methods</li><li><a href="#respoke-DirectConnection">respoke.DirectConnection</a></li><li><a href="#id">id</a></li><li><a href="#getStats">getStats</a></li><li><a href="#accept">accept</a></li><li><a href="#close">close</a></li><li><a href="#sendMessage">sendMessage</a></li><li><a href="#reject">reject</a></li><li><a href="#isActive">isActive</a></li><li><a href="#log">log</a></li><li>Events</li><li><a href="#event-respoke-DirectConnection-open">open</a></li><li><a href="#event-respoke-DirectConnection-close">close</a></li><li><a href="#event-respoke-DirectConnection-message">message</a></li><li><a href="#event-respoke-DirectConnection-error">error</a></li><li><a href="#event-respoke-DirectConnection-stats">stats</a></li><li><a href="#event-respoke-DirectConnection-start">start</a></li></ul></div></div><div id="header" role="navigation" class="nav navbar navbar-default"><div class="container-fluid"><div class="navbar-header"><a href="/" class="navbar-brand">Respoke.js</a><button id="file-menu" data-toggle="collapse" data-target="#navbar-links" class="navbar-toggle collapsed"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button></div><div id="navbar-links" class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href="respoke.Call.html">Call</a></li><li><a href="respoke.Client.html">Client</a></li><li><a href="respoke.Connection.html">Connection</a></li><li class="active"><a href="respoke.DirectConnection.html">DirectConnection</a></li><li><a href="respoke.Endpoint.html">Endpoint</a></li><li><a href="respoke.EventEmitter.html">EventEmitter</a></li><li><a href="respoke.Group.html">Group</a></li><li><a href="respoke.LocalMedia.html">LocalMedia</a></li><li><a href="respoke.Presentable.html">Presentable</a></li><li><a href="respoke.RemoteMedia.html">RemoteMedia</a></li><li><a href="respoke.MediaStats.html">MediaStats</a></li></ul></div></div></div><div class="col-sm-9 col-sm-offset-3"><br class="visible-xs"><h1>respoke.DirectConnection</h1><h5 class="help-block">from respoke/directConnection.js</h5><div id="respoke-DirectConnection" class="comment"><p><strong>extends&nbsp;<a href="respoke.EventEmitter.html"><code>respoke.EventEmitter</code></a></strong></p><div><p>A direct connection via RTCDataChannel, including state and path negotation.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>params</code></div><div class="col-sm-3 wrap"><small><strong>string</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.instanceId</code></div><div class="col-sm-3 wrap"><small><strong>string</strong></small></div><div class="col-sm-5">client id</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.call</code></div><div class="col-sm-3 wrap"><small><strong>respoke.Call</strong></small></div><div class="col-sm-5">The call that is handling state for this direct connection.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.forceTurn]</code></div><div class="col-sm-3 wrap"><small><strong>boolean</strong></small></div><div class="col-sm-5">If true, force the data to flow through relay servers instead of allowing
it to flow peer-to-peer. The relay acts like a blind proxy.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.connectionId</code></div><div class="col-sm-3 wrap"><small><strong>string</strong></small></div><div class="col-sm-5">The connection ID of the remoteEndpoint.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.signalOffer</code></div><div class="col-sm-3 wrap"><small><strong>function</strong></small></div><div class="col-sm-5">Signaling action from SignalingChannel.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.signalConnected</code></div><div class="col-sm-3 wrap"><small><strong>function</strong></small></div><div class="col-sm-5">Signaling action from SignalingChannel.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.signalAnswer</code></div><div class="col-sm-3 wrap"><small><strong>function</strong></small></div><div class="col-sm-5">Signaling action from SignalingChannel.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.signalHangup</code></div><div class="col-sm-3 wrap"><small><strong>function</strong></small></div><div class="col-sm-5">Signaling action from SignalingChannel.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.signalReport</code></div><div class="col-sm-3 wrap"><small><strong>function</strong></small></div><div class="col-sm-5">Signaling action from SignalingChannel.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>params.signalCandidate</code></div><div class="col-sm-3 wrap"><small><strong>function</strong></small></div><div class="col-sm-5">Signaling action from SignalingChannel.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onStart]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onStart</strong></small></div><div class="col-sm-5">Callback for when setup of the direct connection
begins. The direct connection will not be open yet.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onError]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onError</strong></small></div><div class="col-sm-5">Callback for errors that happen during
direct connection setup or media renegotiation.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onClose]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onClose</strong></small></div><div class="col-sm-5">Callback for closing the direct connection.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onOpen]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onOpen</strong></small></div><div class="col-sm-5">Callback for opening the direct connection.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onAccept]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onAccept</strong></small></div><div class="col-sm-5">Callback for when the user accepts the request
for a direct connection and setup is about to begin.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onMessage]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onMessage</strong></small></div><div class="col-sm-5">Callback for incoming messages. Not usually
necessary to listen to this event if you are already listening to respoke.Endpoint#message.</div></div><br class="visible-xs"><br><br><h2>Properties and Methods</h2></div><div id="id" class="comment"><h3><code>string</code><a href="#id" class="bold">id</a></h3><div><p>The unique identifier of the direct connection.</p>
</div><br><br></div><div id="getStats" class="comment"><h3><a href="#getStats"><span class="bold">getStats(params)</span></a></h3><p><strong>returns<code>Promise&lt;object&gt;|undefined</code></strong></p><div><p>Return media stats. Since we have to wait for both the answer and offer to be available before starting
statistics, we&#39;ll return a promise for the stats object.</p>
<pre><code>directConnection.getStats({
    onStats: function (evt) {
        console.log(&#39;Stats&#39;, evt.stats);
    }
}).done(function () {
    console.log(&#39;Stats started.&#39;);
}, function (err) {
    console.log(&#39;Direct connection is already closed.&#39;);
});
</code></pre><p><strong>Using callbacks</strong> by passing <code>params.onSuccess</code> or <code>params.onError</code> will disable promises.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>params</code></div><div class="col-sm-3 wrap"><small><strong>object</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.interval=5000]</code></div><div class="col-sm-3 wrap"><small><strong>number</strong></small></div><div class="col-sm-5">How often in milliseconds to fetch statistics.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onStats]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.MediaStatsParser.statsHandler</strong></small></div><div class="col-sm-5">An optional callback to receive the
stats if the Respoke stats module is loaded. If no callback is provided, the connection's report will
contain stats but the developer will not receive them on the client-side.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onSuccess]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.statsSuccessHandler</strong></small></div><div class="col-sm-5">Success handler for this
invocation of this method only.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onError]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.errorHandler</strong></small></div><div class="col-sm-5">Error handler for this invocation of
this method only.</div></div><br class="visible-xs"><br><br></div><div id="accept" class="comment"><h3><a href="#accept"><span class="bold">accept(params)</span></a></h3><p><strong>fires</strong><code>accept</code></p><div><p>Start the process of obtaining media. saveParameters will only be meaningful for the callee,
since the library calls this method for the caller. Developers will use this method to pass in
callbacks for the callee.</p>
<pre><code>directConnection.accept({
    onOpen: function (evt) {}
});
</code></pre></div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>params</code></div><div class="col-sm-3 wrap"><small><strong>object</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onOpen]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onOpen</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onClose]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onClose</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onMessage]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.onMessage</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="close" class="comment"><h3><a href="#close"><span class="bold">close()</span></a></h3><p><strong>fires</strong><code>close</code></p><div><p>Tear down the connection.</p>
</div><br><br></div><div id="sendMessage" class="comment"><h3><a href="#sendMessage"><span class="bold">sendMessage(params)</span></a></h3><p><strong>returns<code>Promise|undefined</code></strong></p><div><p>Send a message over the datachannel in the form of a JSON-encoded plain old JavaScript object. Only one
attribute may be given: either a string &#39;message&#39; or an object &#39;object&#39;.
<strong>Using callbacks</strong> by passing <code>params.onSuccess</code> or <code>params.onError</code> will disable promises.</p>
<pre><code>directConnection.sendMessage({
    message: &quot;And they say HTTP is stateless!&quot;
});
</code></pre></div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>params</code></div><div class="col-sm-3 wrap"><small><strong>object</strong></small></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.message]</code></div><div class="col-sm-3 wrap"><small><strong>string</strong></small></div><div class="col-sm-5">The message to send.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.object]</code></div><div class="col-sm-3 wrap"><small><strong>object</strong></small></div><div class="col-sm-5">An object to send.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onSuccess]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.sendHandler</strong></small></div><div class="col-sm-5">Success handler for this invocation
of this method only.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>[params.onError]</code></div><div class="col-sm-3 wrap"><small><strong>respoke.DirectConnection.errorHandler</strong></small></div><div class="col-sm-5">Error handler for this invocation
of this method only.</div></div><br class="visible-xs"><br><br></div><div id="reject" class="comment"><h3><code></code><a href="#reject" class="bold">reject</a></h3><div><p>Expose close as reject for approve/reject workflow.</p>
<pre><code>client.listen(&#39;direct-connection, function (evt) {
    if (iDontLikeThisPerson()) {
        evt.directConnection.reject();
    }
});
</code></pre></div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>signal</code></div><div class="col-sm-3 wrap"><small><strong>boolean</strong></small></div><div class="col-sm-5">Optional flag to indicate whether to send or suppress sending
a hangup signal to the remote side.</div></div><br class="visible-xs"><br><br></div><div id="isActive" class="comment"><h3><a href="#isActive"><span class="bold">isActive()</span></a></h3><p><strong>returns<code>boolean</code></strong></p><div><p>Indicate whether a datachannel is being setup or is in progress.</p>
</div><br><br></div><div id="log" class="comment"><h3><a href="#log"><span class="bold">log()</span></a></h3><div><p>Copyright 2014, Digium, Inc.
All rights reserved.</p>
<p>This source code is licensed under The MIT License found in the
LICENSE file in the root directory of this source tree.</p>
<p>For all details and documentation:  <a href="https://www.respoke.io">https://www.respoke.io</a></p>
</div><br><br></div><br><br><h2>Events</h2><p>Listen for events on an instance of this class.</p><pre><code>DirectConnection
.listen(&quot;event-name&quot;, function (evt) {

})</code></pre><br><div id="event-respoke-DirectConnection-open"><h3><code>event</code> <a href="#event-respoke-DirectConnection-open" class="bold">open</a></h3><div><p>The direct connection is open.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>name</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">the event name.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>target</code></div><div class="col-sm-3 wrap"><strong>respoke.DirectConnection</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-respoke-DirectConnection-close"><h3><code>event</code> <a href="#event-respoke-DirectConnection-close" class="bold">close</a></h3><div><p>The direct connection is closed.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>name</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">the event name.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>target</code></div><div class="col-sm-3 wrap"><strong>respoke.DirectConnection</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-respoke-DirectConnection-message"><h3><code>event</code> <a href="#event-respoke-DirectConnection-message" class="bold">message</a></h3><div><p>Incoming message on this direct connection.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>message</code></div><div class="col-sm-3 wrap"><strong>respoke.TextMessage</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>endpoint</code></div><div class="col-sm-3 wrap"><strong>respoke.Endpoint</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>name</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">the event name.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>target</code></div><div class="col-sm-3 wrap"><strong>respoke.DirectConnection</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-respoke-DirectConnection-error"><h3><code>event</code> <a href="#event-respoke-DirectConnection-error" class="bold">error</a></h3><div><p>An error occurred while setting up the direct connection.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>reason</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">A human-readable description of the error.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>name</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">the event name.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>target</code></div><div class="col-sm-3 wrap"><strong>respoke.DirectConnection</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-respoke-DirectConnection-stats"><h3><code>event</code> <a href="#event-respoke-DirectConnection-stats" class="bold">stats</a></h3><div><p>This event is fired every time statistical information about the direct connection
becomes available.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>stats</code></div><div class="col-sm-3 wrap"><strong>object</strong></div><div class="col-sm-5">an object with stats in it.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>target</code></div><div class="col-sm-3 wrap"><strong>respoke.DirectConnection</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>name</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">the event name.</div></div><br class="visible-xs"><br><br></div><div id="event-respoke-DirectConnection-start"><h3><code>event</code> <a href="#event-respoke-DirectConnection-start" class="bold">start</a></h3><div><p>The direct connection setup has begun. This does NOT mean it&#39;s ready to send messages yet. Listen to
DirectConnection#open for that notification.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4 wrap"><code>name</code></div><div class="col-sm-3 wrap"><strong>string</strong></div><div class="col-sm-5">the event name.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4 wrap"><code>target</code></div><div class="col-sm-3 wrap"><strong>respoke.DirectConnection</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><br><br><br><br><br><br><br><br><br><br><br></div><script>hljs.initHighlightingOnLoad();
$(document).on('scroll', setSidebarPosition);
$(window).on('resize', setSidebarPosition);
$('#file-menu').on('click', function () {
  setTimeout(setSidebarPosition, 350);
});
function setSidebarPosition() {
  var s = $(document).scrollTop();
  var h = $('#header').height();
  if (s < h) {
      $('#navi').css('top', ((h - s) + 8) + 'px');
  } else {
      $('#navi').css('top', '0');
  }
}
setSidebarPosition();</script></body></html>